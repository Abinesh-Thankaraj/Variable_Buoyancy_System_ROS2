<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from install/vbs_description/share/vbs_description/urdf/tethys.xacro | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="tethys">
  <!-- Vehicle base link -->
  <link name="tethys/base_link">
    <inertial>
      <mass value="110"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="5.2539" ixy="0.0144" ixz="0.3341" iyy="7.9420" iyz="0.026" izz="6.9123"/>
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://vbs_description/meshes/tethys.dae"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://vbs_description/meshes/tethys.stl"/>
      </geometry>
    </collision>
  </link>
  <!-- ================================== -->
  <!-- Add LRAUV-inspired components -->
  <!-- ================================== -->
  <!-- Battery (mass shifter) -->
  <link name="tethys/battery">
    <inertial>
      <mass value="31.7307"/>
      <origin xyz="0 0 0"/>
      <inertia>
        <ixx>0.2327</ixx>
        <ixy>0</ixy>
        <ixz>-0.0004</ixz>
        <iyy>1.0930</iyy>
        <iyz>0</iyz>
        <izz>1.0344</izz>
      </inertia>
    </inertial>
  </link>
  <joint name="tethys/battery_joint" type="prismatic">
    <parent>tethys/base_link</parent>
    <child>tethys/battery</child>
    <axis>
      <xyz>1 0 0</xyz>
      <limit>
        <lower>-0.03</lower>
        <upper>0.03</upper>
        <effort>1e6</effort>
        <velocity>0.0007</velocity>
      </limit>
    </axis>
  </joint>
  <!-- Drop weight -->
  <link name="tethys/drop_weight">
    <inertial>
      <mass value="1.0"/>
      <origin xyz="0 0 0"/>
      <inertia>
        <ixx>0.000143971303</ixx>
        <iyy>0.000140915448</iyy>
        <izz>0.000033571862</izz>
      </inertia>
    </inertial>
  </link>
  <!-- Buoyancy engine -->
  <link name="tethys/buoyancy_engine">
    <inertial>
      <mass value="0.3"/>
      <origin xyz="0 0 0"/>
      <inertia>
        <ixx>0.000143971303</ixx>
        <ixy>0.000000000008</ixy>
        <ixz>-0.000000000224</ixz>
        <iyy>0.000140915448</iyy>
        <iyz>-0.000025236433</iyz>
        <izz>0.000033571862</izz>
      </inertia>
    </inertial>
  </link>
  <gazebo>
    <!-- Joint state publisher -->
    <plugin filename="ignition-gazebo-joint-state-publisher-system" name="ignition::gazebo::systems::JointStatePublisher"/>
    <!-- Mass shifter controller -->
    <plugin filename="ignition-gazebo-joint-position-controller-system" name="ignition::gazebo::systems::JointPositionController">
      <joint_name>tethys/battery_joint</joint_name>
      <p_gain>0.1</p_gain>
      <use_velocity_commands>true</use_velocity_commands>
      <cmd_max>0.0007</cmd_max>
    </plugin>
    <!-- Detachable joint for drop weight -->
    <plugin filename="ignition-gazebo-detachable-joint-system" name="ignition::gazebo::systems::DetachableJoint">
      <parent_link>tethys/base_link</parent_link>
      <child_model>__model__</child_model>
      <child_link>tethys/drop_weight</child_link>
      <topic>/model/tethys/drop_weight</topic>
    </plugin>
    <!-- Buoyancy system -->
    <plugin filename="ignition-gazebo-buoyancy-system" name="ignition::gazebo::systems::Buoyancy">
      <default_density>1025</default_density>
    </plugin>
    <!-- Custom buoyancy engine plugin (adapted from LRAUV) -->
    <plugin filename="libBuoyancyEnginePlugin.so" name="tethys::BuoyancyEnginePlugin">
      <link_name>tethys/buoyancy_engine</link_name>
      <namespace>tethys</namespace>
      <fluid_density>1025</fluid_density>
      <min_volume>0.000080</min_volume>
      <neutral_volume>0.0005</neutral_volume>
      <default_volume>0.0005</default_volume>
      <max_volume>0.000955</max_volume>
      <max_inflation_rate>0.000003</max_inflation_rate>
    </plugin>
  </gazebo>
  <gazebo>
    <plugin filename="ignition-gazebo-hydrodynamics-system" name="ignition::gazebo::systems::Hydrodynamics">
      <!--     <density>${density}</density> -->
      <!-- Ignition notations from Handbook of Marine Craft, Fossen, 2011 -->
      <link_name>tethys/base_link</link_name>
      <!-- BlueROV2 heavy values from "6-DoF Modelling and Control of a Remotely Operated Vehicle"
        Wu, Master thesis, Flinder University, 2018  -->
      <!-- Negative diagonal values of added mass matrix [Fossen (6.38)] -->
      <xDotU>-5.5</xDotU>
      <yDotV>-12.7</yDotV>
      <zDotW>-14.57</zDotW>
      <kDotP>-0.12</kDotP>
      <mDotQ>-0.12</mDotQ>
      <nDotR>-0.12</nDotR>
      <!-- From "Numerical Modelling and Experimental Testing of the Hydrodynamic Characteristics 
        for an Open-Frame Remotely Operated Vehicle",  Li et al, Marine Science and Engineering, 2020         -->
      <!-- Negative linear damping [Fossen (6.62)] -->
      <!--    <xU>-1.31</xU>    
    <yV>-9.14</yV>
    <zW>-2.015</zW>
    <kP>-0.</kP>
    <mQ>-0.</mQ>
    <nR>-0.</nR>-->
      <!-- Negative quadratic damping [Fossen (6.62)] -->
      <xUabsU>-33.800000000000004</xUabsU>
      <yVabsV>-54.26875</yVabsV>
      <zWabsW>-73.37135</zWabsW>
      <kPabsP>-40.0</kPabsP>
      <mQabsQ>-40.0</mQabsQ>
      <nRabsR>-40.0</nRabsR>
      <!-- BlueROV2 values from "Model Predictive Control for the BlueROV2", 
        Emil MÃ¡r Einarsson, Andris Lipenitis, Master thesis, 2020  -->
      <!-- Negative linear damping -->
      <xU>-25.15</xU>
      <yV>-7.364</yV>
      <zW>-17.955</zW>
      <kP>-10.888</kP>
      <mQ>-20.761</mQ>
      <nR>-3.744</nR>
      <!-- Negative quadratic damping -->
      <!--    <xUU>-17.77</xUU>
    <yVV>-125.9</yVV>
    <zWW>-72.36</zWW>
    <kPP>-0.1246</kPP>
    <mQQ>-0.1246</mQQ>
    <nRR>-0.1857</nRR>-->
    </plugin>
  </gazebo>
  <!-- Fluid density -->
  <link name="tethys/ballast2">
    <visual>
      <geometry>
        <mesh filename="package://vbs_description/meshes/ballast_tank.dae"/>
      </geometry>
    </visual>
    <inertial>
      <!-- ballast axis is X -->
      <origin rpy="0 0 0" xyz="0.04 0 0"/>
      <mass value="1.0"/>
      <inertia ixx="0.0032" ixy="0.0" ixz="0.0" iyy="0.0021333333333333334" iyz="0.0" izz="0.0021333333333333334"/>
    </inertial>
  </link>
  <!-- Joint between ballast link and vehicle base link -->
  <joint name="ballast2" type="continuous">
    <origin rpy="0 1.5707963268 0" xyz="0.7 0 0.155"/>
    <axis xyz="-1 0 0"/>
    <parent link="tethys/base_link"/>
    <child link="tethys/ballast2"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>tethys</namespace>
      <joint_name>ballast2</joint_name>
      <topic>ballast2/cmd</topic>
      <thrust_coefficient>0.015</thrust_coefficient>
      <fluid_density>1025</fluid_density>
      <propeller_diameter>0.16</propeller_diameter>
      <velocity_control>true</velocity_control>
      <use_angvel_cmd>false</use_angvel_cmd>
      <max_thrust_cmd>40</max_thrust_cmd>
      <min_thrust_cmd>-40</min_thrust_cmd>
    </plugin>
  </gazebo>
  <link name="tethys/ballast1">
    <visual>
      <geometry>
        <mesh filename="package://vbs_description/meshes/ballast_tank.dae"/>
      </geometry>
    </visual>
    <inertial>
      <!-- ballast axis is X -->
      <origin rpy="0 0 0" xyz="0.04 0 0"/>
      <mass value="1.0"/>
      <inertia ixx="0.0032" ixy="0.0" ixz="0.0" iyy="0.0021333333333333334" iyz="0.0" izz="0.0021333333333333334"/>
    </inertial>
  </link>
  <!-- Joint between ballast link and vehicle base link -->
  <joint name="ballast1" type="continuous">
    <origin rpy="0 -1.5707963268 0" xyz="-0.7 0 0.155"/>
    <axis xyz="1 0 0"/>
    <parent link="tethys/base_link"/>
    <child link="tethys/ballast1"/>
    <limits effort="-1" velocity="-1"/>
  </joint>
  <gazebo>
    <plugin filename="ignition-gazebo-thruster-system" name="ignition::gazebo::systems::Thruster">
      <namespace>tethys</namespace>
      <joint_name>ballast1</joint_name>
      <topic>ballast1/cmd</topic>
      <thrust_coefficient>0.015</thrust_coefficient>
      <fluid_density>1025</fluid_density>
      <propeller_diameter>0.16</propeller_diameter>
      <velocity_control>true</velocity_control>
      <use_angvel_cmd>false</use_angvel_cmd>
      <max_thrust_cmd>40</max_thrust_cmd>
      <min_thrust_cmd>-40</min_thrust_cmd>
    </plugin>
  </gazebo>
  <link name="tethys/mpu"/>
  <gazebo reference="tethys/mpu">
    <sensor name="mpu_imu" type="imu">
      <always_on>1</always_on>
      <update_rate>10</update_rate>
      <visualize>true</visualize>
      <topic>tethys/mpu</topic>
      <gz_frame_id>tethys/mpu</gz_frame_id>
      <imu>
        <angular_velocity>
          <x>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.009</stddev>
              <bias_mean>0.00075</bias_mean>
              <bias_stddev>0.005</bias_stddev>
              <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
              <precision>0.00025</precision>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.009</stddev>
              <bias_mean>0.00075</bias_mean>
              <bias_stddev>0.005</bias_stddev>
              <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
              <precision>0.00025</precision>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.009</stddev>
              <bias_mean>0.00075</bias_mean>
              <bias_stddev>0.005</bias_stddev>
              <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
              <precision>0.00025</precision>
            </noise>
          </z>
        </angular_velocity>
        <linear_acceleration>
          <x>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.021</stddev>
              <bias_mean>0.05</bias_mean>
              <bias_stddev>0.0075</bias_stddev>
              <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
              <precision>0.005</precision>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.021</stddev>
              <bias_mean>0.05</bias_mean>
              <bias_stddev>0.0075</bias_stddev>
              <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
              <precision>0.005</precision>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.021</stddev>
              <bias_mean>0.05</bias_mean>
              <bias_stddev>0.0075</bias_stddev>
              <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
              <precision>0.005</precision>
            </noise>
          </z>
        </linear_acceleration>
        <orientation_reference_frame>
          <localization>ENU</localization>
        </orientation_reference_frame>
      </imu>
    </sensor>
  </gazebo>
  <joint name="mpu_joint" type="fixed">
    <origin rpy="0 0 -1.57079635" xyz="0.1 0 0"/>
    <parent link="tethys/base_link"/>
    <child link="tethys/mpu"/>
  </joint>
  <link name="tethys/lsm"/>
  <gazebo reference="tethys/lsm">
    <sensor name="lsm_imu" type="imu">
      <always_on>1</always_on>
      <update_rate>10</update_rate>
      <visualize>true</visualize>
      <topic>tethys/lsm</topic>
      <gz_frame_id>tethys/lsm</gz_frame_id>
      <imu>
        <angular_velocity>
          <x>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.009</stddev>
              <bias_mean>0.00075</bias_mean>
              <bias_stddev>0.005</bias_stddev>
              <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
              <precision>0.00025</precision>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.009</stddev>
              <bias_mean>0.00075</bias_mean>
              <bias_stddev>0.005</bias_stddev>
              <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
              <precision>0.00025</precision>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.009</stddev>
              <bias_mean>0.00075</bias_mean>
              <bias_stddev>0.005</bias_stddev>
              <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
              <precision>0.00025</precision>
            </noise>
          </z>
        </angular_velocity>
        <linear_acceleration>
          <x>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.021</stddev>
              <bias_mean>0.05</bias_mean>
              <bias_stddev>0.0075</bias_stddev>
              <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
              <precision>0.005</precision>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.021</stddev>
              <bias_mean>0.05</bias_mean>
              <bias_stddev>0.0075</bias_stddev>
              <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
              <precision>0.005</precision>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0</mean>
              <stddev>0.021</stddev>
              <bias_mean>0.05</bias_mean>
              <bias_stddev>0.0075</bias_stddev>
              <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
              <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
              <precision>0.005</precision>
            </noise>
          </z>
        </linear_acceleration>
        <orientation_reference_frame>
          <localization>ENU</localization>
        </orientation_reference_frame>
      </imu>
    </sensor>
  </gazebo>
  <joint name="lsm_joint" type="fixed">
    <origin rpy="0 0 -1.57079635" xyz="0.1 0 0"/>
    <parent link="tethys/base_link"/>
    <child link="tethys/lsm"/>
  </joint>
  <link name="tethys/baro"/>
  <gazebo reference="tethys/baro">
    <sensor name="baro_pressure" type="altimeter">
      <always_on>true</always_on>
      <update_rate>10</update_rate>
      <topic>tethys/baro</topic>
      <gz_frame_id>tethys/baro</gz_frame_id>
      <altimeter>
        <vertical_position>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>0.1</stddev>
            <bias_mean>0.0</bias_mean>
            <bias_stddev>0.0</bias_stddev>
          </noise>
        </vertical_position>
        <vertical_velocity>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>0.01</stddev>
            <bias_mean>0.0</bias_mean>
            <bias_stddev>0.0</bias_stddev>
          </noise>
        </vertical_velocity>
      </altimeter>
    </sensor>
  </gazebo>
  <joint name="baro_joint" type="fixed">
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <parent link="tethys/base_link"/>
    <child link="tethys/baro"/>
  </joint>
</robot>
